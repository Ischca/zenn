---
title: "Claude Code実践ガイド: サブエージェントと責務分割"
emoji: "🤖"
type: "tech"
topics: ["claudecode", "ai", "cli", "開発ツール"]
published: false
---

## はじめに

タスクが大きくなると、Claude Codeも途中で迷子になることがあります。サブエージェントは、そういった場面で使える「分業」の仕組みです。主にコンテキストを圧迫しないための手段として有効です。この記事では、サブエージェントの仕組みと使いどころを整理します。

## サブエージェントとは

サブエージェントは、Claude Codeがタスクを委譲できる専門的なAIアシスタントです。

[公式ドキュメント](https://code.claude.com/docs/en/sub-agents)では次のように説明されています：

> サブエージェントは、Claudeがタスクを委譲できる事前設定されたAIパーソナリティです。各サブエージェントは：
> - 特定の目的と専門領域を持つ
> - メイン会話とは別の独自のコンテキストウィンドウを使用する
> - 使用可能な特定のツールで設定できる
> - 振る舞いを導くカスタムシステムプロンプトを含む
>
> Claude Codeがサブエージェントの専門領域に合うタスクに遭遇すると、そのサブエージェントにタスクを委譲できます。サブエージェントは独立して作業し、結果を返します。

重要なのは「独自のコンテキストウィンドウを使用する」という点です。メインの会話とは別のコンテキストで動作し、作業結果の要約だけがメイン会話に返されます。

## スキルとサブエージェントの違い

前回の記事で紹介したスキルとサブエージェントは、どちらもClaudeの能力を拡張しますが、動作が異なります。

[公式ドキュメント](https://code.claude.com/docs/en/features-overview)では次のように説明されています：

> スキルは参照またはアクションです。参照スキルはセッション全体でClaudeが使用する知識（APIスタイルガイドなど）を提供します。アクションスキルはClaudeに特定のことをするよう指示します（デプロイワークフローなど）。
>
> コンテキストの分離が必要な場合、またはコンテキストウィンドウがいっぱいになってきた場合はサブエージェントを使用します。サブエージェントは数十のファイルを読んだり、広範な検索を行ったりするかもしれませんが、メイン会話には要約だけが返されます。サブエージェントの作業はメインコンテキストを消費しないため、中間作業を可視化しておく必要がない場合にも便利です。

| 特徴 | スキル | サブエージェント |
|------|--------|------------------|
| コンテキスト | メイン会話内 | 独立したコンテキスト |
| 結果の扱い | そのまま会話に残る | 要約だけが返る |
| 向いている作業 | 知識参照、軽量なワークフロー | 大量の探索、並列実行 |

## 組み込みサブエージェント

Claude Codeには3つの組み込みサブエージェントがあります。

[公式ドキュメント](https://code.claude.com/docs/en/sub-agents)から引用します：

### Explore

> Exploreサブエージェントは、コードベースの検索と分析に最適化された高速・軽量なエージェントです。厳密な読み取り専用モードで動作し、ファイルの作成、変更、削除はできません。
>
> **主な特徴：**
> - モデル：高速・低レイテンシな検索のためHaikuを使用
> - モード：厳密に読み取り専用

Claudeがコードベースを検索・理解する必要があるが変更は不要な場合に使われます。

### Plan

> Planサブエージェントは、Planモード中に使用するために設計された特殊な組み込みエージェントです。ClaudeがPlanモード（非実行モード）で動作しているとき、計画を提示する前にコードベースを調査し情報を収集するためにPlanサブエージェントを使用します。

Planモード（後の記事で詳述）での調査に特化したサブエージェントです。

### general-purpose

> general-purposeサブエージェントは、探索とアクションの両方を必要とする複雑なマルチステップタスク向けの汎用エージェントです。Exploreサブエージェントとは異なり、ファイルの変更やより広範な操作を実行できます。
>
> **主な特徴：**
> - モデル：より高度な推論のためSonnetを使用
> - ツール：すべてのツールにアクセス可能
> - モード：ファイルの読み書き、コマンド実行、変更が可能

## なぜサブエージェントが必要か

[公式ドキュメント](https://code.claude.com/docs/en/sub-agents)では、サブエージェントの主要なメリットを以下のように挙げています：

> **コンテキストの保全**：各サブエージェントは独自のコンテキストで動作し、メイン会話の汚染を防ぎ、ハイレベルな目的に集中させます。
>
> **専門的な専門知識**：サブエージェントは特定のドメイン向けに詳細な指示で微調整でき、指定されたタスクでの成功率が高くなります。
>
> **再利用性**：一度作成したサブエージェントは、異なるプロジェクトで使用でき、チームと共有して一貫したワークフローを実現できます。
>
> **柔軟な権限**：各サブエージェントは異なるツールアクセスレベルを持つことができ、強力なツールを特定のサブエージェントタイプに制限できます。

特に「コンテキストの保全」は重要です。大量のファイルを検索する作業をメインエージェントで行うとコンテキストがすぐに埋まりますが、サブエージェントに委譲すれば、メイン会話には要約だけが返されます。

## サブエージェントを使うべき場面

[Anthropicのベストプラクティス](https://www.anthropic.com/engineering/claude-code-best-practices)では次のように述べています：

> サブエージェントを使って詳細を確認したり、特定の疑問を調査するようClaudeに指示すると、特に会話やタスクの初期段階で、効率低下のデメリットがほとんどなくコンテキストの可用性を保てる傾向があります。

実践的には以下のケースでサブエージェントを検討します：

**使うべき場面**
- 大量のファイル検索・読み込みが必要
- コードベース全体のレビューや分析
- 並列で独立した調査を行いたい

**不要な場面**
- バグ修正（1〜3ファイル）
- 小〜中規模の機能追加
- 単純な質問への回答

## カスタムサブエージェントの作成

### ファイル構成

`.claude/agents/`ディレクトリにMarkdownファイルとして配置します。

```
.claude/agents/
├── code-reviewer.md
├── debugger.md
└── test-runner.md
```

### 設定ファイルの構造

[公式ドキュメント](https://code.claude.com/docs/en/sub-agents)の例を参考にします：

```markdown
---
name: code-reviewer
description: コードレビューの専門家。コード変更後に積極的にレビュー。
tools: Read, Grep, Glob, Bash
model: sonnet
---

あなたはシニアコードレビューアーです。

呼び出されたとき：
1. git diffで最近の変更を確認
2. 変更されたファイルに焦点を当てる
3. 即座にレビューを開始

レビューチェックリスト：
- コードがシンプルで読みやすい
- 関数と変数の命名が適切
- 適切なエラーハンドリング
```

| フィールド | 必須 | 説明 |
|-----------|------|------|
| `name` | Yes | 一意の識別子 |
| `description` | Yes | Claudeが委譲を判断する際に使用 |
| `tools` | No | 使用可能なツール（省略時は全ツール継承） |
| `model` | No | sonnet, opus, haiku, inherit |

`description`フィールドが重要です。Claudeはこの説明を読んで、どのサブエージェントに委譲するか判断します。

## 注意点

**サブエージェントはネストできない**
サブエージェントが別のサブエージェントを生成することはできません。ネストが必要なワークフローでは、メイン会話からサブエージェントをチェーンさせます。

**レイテンシを考慮する**
サブエージェントは毎回新しいインスタンスとして起動し、コンテキストを収集する時間が必要です。単純な作業には向きません。

## まとめ

- サブエージェントは独立したコンテキストで動作する専門エージェント
- スキルとは異なり、作業結果の要約だけがメイン会話に返される
- 組み込みサブエージェントにはExplore、Plan、general-purposeがある
- コンテキストの保全、専門性の適用、並列実行がメリット
- `.claude/agents/`に配置し、descriptionで自動委譲を制御
