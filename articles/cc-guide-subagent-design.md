---
title: "Claude Codeにも分業させよう 〜サブエージェントの使い方〜"
emoji: "🤖"
type: "tech"
topics: ["claudecode", "ai", "cli", "開発ツール"]
published: true
published_at: 2026-02-09 16:00
---

## はじめに

タスクが大きくなると、Claude Codeも途中で迷子になることがあります。
サブエージェントは、そういった場面で使える「分業」の仕組みです。
主にコンテキストを圧迫しないための手段として有効です。
この記事では、サブエージェントの仕組みと使いどころを整理します。

## サブエージェントとは

サブエージェントは、Claude Codeがタスクを委譲できる専門的なAIアシスタントです。
特定の目的と専門領域を持ち、メイン会話とは別の独立したコンテキストで動作します。

サブエージェントに委譲されたタスクは独立して処理され、作業結果の要約だけがメイン会話に返されます。
これが「コンテキストの分離」というサブエージェントの本質です。

## スキルとサブエージェントの違い

前回の記事で紹介したスキルとサブエージェントは、どちらもClaudeの能力を拡張します。
ただし動作が異なります。

[公式ドキュメント](https://code.claude.com/docs/en/features-overview)では次のように説明されています。

> スキルは参照またはアクションです。参照スキルはセッション全体でClaudeが使用する知識（APIスタイルガイドなど）を提供します。アクションスキルはClaudeに特定のことをするよう指示します（デプロイワークフローなど）。
>
> コンテキストの分離が必要な場合、またはコンテキストウィンドウがいっぱいになってきた場合はサブエージェントを使用します。サブエージェントは数十のファイルを読んだり、広範な検索を行ったりするかもしれませんが、メイン会話には要約だけが返されます。サブエージェントの作業はメインコンテキストを消費しないため、中間作業を可視化しておく必要がない場合にも便利です。

| 特徴 | スキル | サブエージェント |
|------|--------|------------------|
| コンテキスト | メイン会話内 | 独立したコンテキスト |
| 結果の扱い | そのまま会話に残る | 要約だけが返る |
| 向いている作業 | 知識参照、軽量なワークフロー | 大量の探索、並列実行 |

## 組み込みサブエージェント

Claude Codeには3つの組み込みサブエージェントがあります。

[公式ドキュメント](https://code.claude.com/docs/en/sub-agents)から引用します。

### Explore

> Exploreサブエージェントは、コードベースの検索と分析に最適化された高速・軽量なエージェントです。厳密な読み取り専用モードで動作し、ファイルの作成、変更、削除はできません。
>
> **主な特徴：**
> - モデル：高速・低レイテンシな検索のためHaikuを使用
> - モード：厳密に読み取り専用

Claudeがコードベースを検索・理解する必要があるが変更は不要な場合に使われます。

### Plan

> Planサブエージェントは、Planモード中に使用するために設計された特殊な組み込みエージェントです。ClaudeがPlanモード（非実行モード）で動作しているとき、計画を提示する前にコードベースを調査し情報を収集するためにPlanサブエージェントを使用します。

Planモード（後の記事で詳述）での調査に特化したサブエージェントです。

### general-purpose

> general-purposeサブエージェントは、探索とアクションの両方を必要とする複雑なマルチステップタスク向けの汎用エージェントです。Exploreサブエージェントとは異なり、ファイルの変更やより広範な操作を実行できます。
>
> **主な特徴：**
> - モデル：より高度な推論のためSonnetを使用
> - ツール：すべてのツールにアクセス可能
> - モード：ファイルの読み書き、コマンド実行、変更が可能

## なぜサブエージェントが必要か

サブエージェントの主なメリットは以下の4つです。

- コンテキストの保全（メイン会話のコンテキストを消費しない）
- 専門性の適用（特定のドメイン向けに最適化した指示を与えられる）
- 再利用性（一度作成すれば、チームで共有できる）
- 権限の分離（サブエージェントごとに使えるツールを制限できる）

特にコンテキストの保全は重要です。
大量のファイルを検索する作業をメインエージェントで行うとコンテキストがすぐに埋まりますが、サブエージェントに委譲すれば、メイン会話には要約だけが返されます。

## サブエージェントを使うべき場面

[Anthropicのベストプラクティス](https://www.anthropic.com/engineering/claude-code-best-practices)では次のように述べています。

> サブエージェントを使って詳細を確認したり、特定の疑問を調査するようClaudeに指示すると、特に会話やタスクの初期段階で、効率低下のデメリットがほとんどなくコンテキストの可用性を保てる傾向があります。

大量のファイル検索、コードベース全体の分析、並列での調査など、探索範囲が広い作業にはサブエージェントが向いています。
一方、1〜3ファイル程度のバグ修正や単純な質問には向きません。
毎回新しいインスタンスとして起動するため、軽量な作業ではオーバーヘッドの方が大きくなります。

## カスタムサブエージェントの作成

### ファイル構成

`.claude/agents/`ディレクトリにMarkdownファイルとして配置します。

```
.claude/agents/
├── code-reviewer.md
├── debugger.md
└── test-runner.md
```

### 設定ファイルの構造

[公式ドキュメント](https://code.claude.com/docs/en/sub-agents)の例を参考にします。

```markdown
---
name: code-reviewer
description: コードレビューの専門家。コード変更後に積極的にレビュー。
tools: Read, Grep, Glob, Bash
model: sonnet
---

あなたはシニアコードレビューアーです。

呼び出されたときは以下を実行する。
1. git diffで最近の変更を確認
2. 変更されたファイルに焦点を当てる
3. 即座にレビューを開始

レビューチェックリストは以下。
- コードがシンプルで読みやすい
- 関数と変数の命名が適切
- 適切なエラーハンドリング
```

| フィールド | 必須 | 説明 |
|-----------|------|------|
| `name` | Yes | 一意の識別子 |
| `description` | Yes | Claudeが委譲を判断する際に使用 |
| `tools` | No | 使用可能なツール（省略時は全ツール継承） |
| `model` | No | sonnet, opus, haiku, inherit |

`description`フィールドが重要です。
Claudeはこの説明を読んで、どのサブエージェントに委譲するか判断します。

## 注意点

サブエージェントにはいくつかの制約があります。

- ネスト不可。サブエージェントから別のサブエージェントは生成できない。チェーンが必要ならメイン会話から順次呼び出す
- 起動コストがある。毎回新しいインスタンスとして起動するため、単純な作業には向かない

## まとめ

- サブエージェントは独立したコンテキストで動作する専門エージェント
- スキルとは異なり、作業結果の要約だけがメイン会話に返される
- 組み込みサブエージェントにはExplore、Plan、general-purposeがある
- コンテキストの保全、専門性の適用、並列実行がメリット
- `.claude/agents/`に配置し、descriptionで自動委譲を制御
